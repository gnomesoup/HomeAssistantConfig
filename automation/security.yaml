- id: arm_when_away
  alias: Arm Home When Away
  trigger:
    - platform: state
      entity_id: input_select.presence
      from: "Home"
      to: "Away"
  action:
    - service: ifttt.trigger
      data: {"event":"home_armed"}
    - service: notify.notify
      data:
        message: "System is armed"
- id: disarm_when_home
  alias: Disarm Home When Home
  trigger:
    - platform: state
      entity_id: input_select.presence
      from: "Away"
      to: "Home"
  action:
    - service: ifttt.trigger
      data: {"event":"home_disarmed"}
    - service: notify.notify
      data:
        message: "System is disarmed"

- id: alert_when_wet
  alias: Send Alert When Water Detected
  trigger:
    - platform: state
      entity_id: sensor.water_leak_sensor_water
      from: 'dry'
      to: 'wet'
  action:
    - service: notify.notify
      data_template:
        message: >-
          {{ trigger.to_state.attributes.friendly }} detected water!

- id: alert_when_motion
  alias: Send Alert When Motion And Away
  trigger:
    - platform: state
      entity_id: binary_sensor.aeotec_multisensor_sensor_bedroom
      to: "on"
    - platform: numeric_state
      entity_id: sensor.aeotec_multisensor_burglar_living_room
      above: 2
  # condition:
  #   - condition: state
  #     entity_id: input_select.presence
  #     state: "Away"
  action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.motion_alert

# - id: alert_test
#   alias: Testing motion sensors
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.aeotec_multisensor_sensor_bedroom
#       to: "on"
#   action:
#     - service: input_boolean.toggle
#       entity_id: input_boolean.testing

## select "Cleaning" mode when appropriate
- id: setup_cleaning
  alias: Turn on cleaning mode
  trigger:
    - platform: template
      value_template: >-
        {{ states.sensor.time.state == states.input_datetime.clean_start.state }}
  # TODO change to value template to check against input_select.clean_day
  condition:
    - condition: time
      weekday:
        - wed
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_mode
        option: "Cleaning"

# cleaning mode turn on all lights
- id: cleaning_welcome
  alias: Welcome cleaner
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.aeotec_multisensor_sensor_living_room
        - binary_sensor.aeotec_multisensor_sensor_bedroom
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.cleaner_present
      state: "off"
    - condition: state
      entity_id: input_select.home_mode
      state: "Cleaning"
    - condition: state
      entity_id: input_select.presence
      state: "Away"
  action:
    - service: homeassistant.turn_on
      entity_id:
        - group.lights
        - input_boolean.cleaner_present
    - service: notify.notify
      data:
        message: "The cleaner has arrived"

- id: cleaner_goodbye
  alias: Cleaner Goodbye
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.aeotec_multisensor_sensor_living_room
        - binary_sensor.aeotec_multisensor_sensor_bedroom
      to: "off"
      for:
        minutes: 30
  condition:
    - condition: state
      entity_id: input_boolean.cleaner_present
      state: "on"
    - condition: state
      entity_id: input_select.home_mode
      state: "Cleaning"
  action:
    - service: homeassistant.turn_off
      entity_id:
        - group.lights
        - input_boolean.cleaner_present
    - service: input_select.select_option
      data:
        entity_id: input_select.home_mode
        option: "Normal"
    - service: notify.notify
      data:
        message: "The cleaner has left"

- id: cleaner_no_show
  alias: Cleaner Didn't Show
  trigger:
    - platform: template
      value_template: {{ states.sensor.time.state == states.input_datetime.clean_end.state }}
  condition:
    - condition: state
      entity_id: input_select.home_mode
      state: "Cleaning"
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.home_mode
        option: "Normal"
    - service: notify.notify
      data:
        message: "The cleaner never showed"
